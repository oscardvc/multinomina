<?php
#20001000000200000293
#AAD990814BP7
# Username and Password, assigned by FINKOK
$username = 'jonathan.colmenares.tellez@gmail.com';
$password = 'T!3mp035l0ng1tud';

# Read the xml file and encode it on base64

//timbrado satisfactoriamente
/*
$xml_content = '<?xml version="1.0" encoding="UTF-8"?>
<cfdi:Comprobante xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd" version="3.2" fecha="2014-01-01T16:50:47" sello="r/ERXkxa9g7khhP0kB192Zk46d0wDKyoAIbH7QWkWRPrnE+8gO26MjA5hBa3tEW+kbtvhhYuevjG8c793hK0Xzq4Uc9g4j9PR0J99wSL32lI5WXxTI3MrGaBAQC5hTPulcJ577q6rT8qcHbAGyYPbxkOEJB7ZaCWF8+FwkaPd6E=" formaDePago="PAGO EN UNA SOLA EXHIBICION" noCertificado="20001000000200000293" certificado="MIIE2jCCA8KgAwIBAgIUMjAwMDEwMDAwMDAyMDAwMDAyOTMwDQYJKoZIhvcNAQEFBQAwggFcMRowGAYDVQQDDBFBLkMuIDIgZGUgcHJ1ZWJhczEvMC0GA1UECgwmU2VydmljaW8gZGUgQWRtaW5pc3RyYWNpw7NuIFRyaWJ1dGFyaWExODA2BgNVBAsML0FkbWluaXN0cmFjacOzbiBkZSBTZWd1cmlkYWQgZGUgbGEgSW5mb3JtYWNpw7NuMSkwJwYJKoZIhvcNAQkBFhphc2lzbmV0QHBydWViYXMuc2F0LmdvYi5teDEmMCQGA1UECQwdQXYuIEhpZGFsZ28gNzcsIENvbC4gR3VlcnJlcm8xDjAMBgNVBBEMBTA2MzAwMQswCQYDVQQGEwJNWDEZMBcGA1UECAwQRGlzdHJpdG8gRmVkZXJhbDESMBAGA1UEBwwJQ295b2Fjw6FuMTQwMgYJKoZIhvcNAQkCDCVSZXNwb25zYWJsZTogQXJhY2VsaSBHYW5kYXJhIEJhdXRpc3RhMB4XDTEyMTAyNjE5MjI0M1oXDTE2MTAyNjE5MjI0M1owggFTMUkwRwYDVQQDE0BBU09DSUFDSU9OIERFIEFHUklDVUxUT1JFUyBERUwgRElTVFJJVE8gREUgUklFR08gMDA0IERPTiBNQVJUSU4gMWEwXwYDVQQpE1hBU09DSUFDSU9OIERFIEFHUklDVUxUT1JFUyBERUwgRElTVFJJVE8gREUgUklFR08gMDA0IERPTiBNQVJUSU4gQ09BSFVJTEEgWSBOVUVWTyBMRU9OIEFDMUkwRwYDVQQKE0BBU09DSUFDSU9OIERFIEFHUklDVUxUT1JFUyBERUwgRElTVFJJVE8gREUgUklFR08gMDA0IERPTiBNQVJUSU4gMSUwIwYDVQQtExxBQUQ5OTA4MTRCUDcgLyBIRUdUNzYxMDAzNFMyMR4wHAYDVQQFExUgLyBIRUdUNzYxMDAzTURGUk5OMDkxETAPBgNVBAsTCFNlcnZpZG9yMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDlrI9loozd+UcW7YHtqJimQjzX9wHIUcc1KZyBBB8/5fZsgZ/smWS4Sd6HnPs9GSTtnTmM4bEgx28N3ulUshaaBEtZo3tsjwkBV/yVQ3SRyMDkqBA2NEjbcum+e/MdCMHiPI1eSGHEpdESt55a0S6N24PW732Xm3ZbGgOp1tht1wIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEAuoPXe+BBIrmJn+IGeI+m97OlP3RC4Ct3amjGmZICbvhI9BTBLCL/PzQjjWBwU0MG8uK6e/gcB9f+klPiXhQTeI1YKzFtWrzctpNEJYo0KXMgvDiputKphQ324dP0nzkKUfXlRIzScJJCSgRw9ZifKWN0D9qTdkNkjk83ToPgwnldg5lzU62woXo4AKbcuabAYOVoC7owM5bfNuWJe566UzD6i5PFY15jYMzi1+ICriDItCv3S+JdqyrBrX3RloZhdyXqs2Htxfw4b1OcYboPCu4+9qM3OV02wyGKlGQMhfrXNwYyj8huxS1pHghEROM2Zs0paZUOy+6ajM+Xh0LX2w==" subTotal="4910.42" descuento="188.42" motivoDescuento="DEDUCCIONES NOMINA" total="4722" tipoDeComprobante="egreso" metodoDePago="DEPOSITO" LugarExpedicion="OAXACA DE JUAREZ, OAXACA."><cfdi:Emisor rfc="AAD990814BP7" nombre="ASOCIACION DE AGRICULTORES DEL DISTRITO DE RIEGO 004 DON MARTIN"><cfdi:DomicilioFiscal calle="DIAGONAL DE MARGARITAS" noExterior="109" colonia="REFORMA" localidad="OAXACA DE JUAREZ, OAXACA." referencia="PLANTA ALTA" municipio="OAXACA DE JUAREZ" estado="OAXACA" pais="MEXICO" codigoPostal="68050"/><cfdi:RegimenFiscal Regimen="PERSONAS MORALES DEL REGIMEN GENERAL"/></cfdi:Emisor><cfdi:Receptor rfc="AALV7904143C9" nombre="ALTAMIRANO LUIS VALERIANO"/><cfdi:Conceptos><cfdi:Concepto cantidad="1" unidad="Servicio" descripcion="PAGO DE NOMINA" valorUnitario="4910.42" importe="4910.42"/></cfdi:Conceptos><cfdi:Impuestos><cfdi:Retenciones><cfdi:Retencion impuesto="ISR" importe="0.00"/></cfdi:Retenciones></cfdi:Impuestos><cfdi:Complemento><nomina:Nomina xmlns:nomina="http://www.sat.gob.mx/nomina" xsi:schemaLocation="http://www.sat.gob.mx/nomina http://www.sat.gob.mx/sitio_internet/cfd/nomina/nomina11.xsd" Version="1.1" RegistroPatronal="D6857385100" NumEmpleado="1" CURP="AALV790414HOCLSL02" TipoRegimen="2" NumSeguridadSocial="78967908662" FechaPago="2014-01-01" FechaInicialPago="2013-12-27" FechaFinalPago="2014-01-02" NumDiasPagados="7" FechaInicioRelLaboral="2009-05-18" Antiguedad="241" Puesto="EMPLEADO DE MOSTRADOR" PeriodicidadPago="Semanal" SalarioBaseCotApor="61.38" RiesgoPuesto="1" SalarioDiarioIntegrado="64.49"><nomina:Percepciones TotalGravado="2215.34" TotalExento="2695.08"><nomina:Percepcion TipoPercepcion="001" Clave="008" Concepto="Sueldo" ImporteGravado="429.66" ImporteExento="0"/><nomina:Percepcion TipoPercepcion="016" Clave="019" Concepto="Alimentacion" ImporteGravado="892.84" ImporteExento="1347.54"/><nomina:Percepcion TipoPercepcion="016" Clave="020" Concepto="Habitacion" ImporteGravado="892.84" ImporteExento="1347.54"/></nomina:Percepciones><nomina:Deducciones TotalGravado="0" TotalExento="188.42"><nomina:Deduccion TipoDeduccion="002" Clave="023" Concepto="ISR" ImporteGravado="0" ImporteExento="0.00"/><nomina:Deduccion TipoDeduccion="004" Clave="025" Concepto="Retencion por alimentacion" ImporteGravado="0" ImporteExento="94.21"/><nomina:Deduccion TipoDeduccion="004" Clave="026" Concepto="Retencion por habitacion" ImporteGravado="0" ImporteExento="94.21"/></nomina:Deducciones></nomina:Nomina></cfdi:Complemento></cfdi:Comprobante>';
*/

$xml_content = '<?xml version="1.0" encoding="UTF-8"?>
<cfdi:Comprobante xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd" version="3.2" fecha="2014-01-03T19:05:07" sello="F3KhqshJHdybHbsrcvFeGCRQg5vitPy2neQcQPMhMmpsjysyYsF161lx2PYynclo+8Y42zwJGDSfuybATavqeyoqhiozFnGwDMNqB4KkLScNep1diNll+jzsKLOo09DTKdapunMpPxy+psnq2j0yASVszX5U//DwoF95anO9I2Y=" formaDePago="PAGO EN UNA SOLA EXHIBICION" noCertificado="00001000000202854604" certificado="MIIEbjCCA1agAwIBAgIUMDAwMDEwMDAwMDAyMDI4NTQ2MDQwDQYJKoZIhvcNAQEFBQAwggGVMTgwNgYDVQQDDC9BLkMuIGRlbCBTZXJ2aWNpbyBkZSBBZG1pbmlzdHJhY2nDs24gVHJpYnV0YXJpYTEvMC0GA1UECgwmU2VydmljaW8gZGUgQWRtaW5pc3RyYWNpw7NuIFRyaWJ1dGFyaWExODA2BgNVBAsML0FkbWluaXN0cmFjacOzbiBkZSBTZWd1cmlkYWQgZGUgbGEgSW5mb3JtYWNpw7NuMSEwHwYJKoZIhvcNAQkBFhJhc2lzbmV0QHNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxFDASBgNVBAcMC0N1YXVodMOpbW9jMRUwEwYDVQQtEwxTQVQ5NzA3MDFOTjMxPjA8BgkqhkiG9w0BCQIML1Jlc3BvbnNhYmxlOiBDZWNpbGlhIEd1aWxsZXJtaW5hIEdhcmPDrWEgR3VlcnJhMB4XDTEzMDExOTE2NTkwOVoXDTE3MDExOTE2NTkwOVowga8xGzAZBgNVBAMTElBST01BWkFBTyBTQSBERSBDVjEbMBkGA1UEKRMSUFJPTUFaQUFPIFNBIERFIENWMRswGQYDVQQKExJQUk9NQVpBQU8gU0EgREUgQ1YxJTAjBgNVBC0THFBSTzEyMTIyOVNMMyAvIFNBUkE2ODAzMjBTSjExHjAcBgNVBAUTFSAvIFNBUkE2ODAzMjBIREZORFIwMTEPMA0GA1UECxMGVU5JREFEMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCo5TXi6tBToSBuedy8U1NK1g+xPOuwARUeJdAbfep2kaQyvnb03qVE5J/yAbviFfWufB+UQu5IRgBfu7Dokd3n3Oyg46X0jhiV3nEVn3ENAr3fWzWiD8fYvVrh+X2HCpcsZ6ey05lOde/K724Vja/n1di4A4pB+XRLDW428Uw8sQIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEAoXrqX8VdrvEIDr9DaqQkBIyqF2x7N0woQM4hCG1jrL7BrmOlziJ0VOIgsfKq/ELj8hgQtKESCQt07vWXIquZ1ktKUZ3qmdbu3OG6y0avnIopJ1mJu2SYkirw11ogc5fXHHi5U0cdo7Hq61UnaBrzNARsjz+AexLqhY7wbLLKvY1FIFi4UH1MP8JMfUsLABvJuCAtf+lCQUgyP+bMDc82+QhjYgWewCx0T2KhGdHt/wiAJ4W//vWg2Nv/Z3tNolMmDCtmC8iOpkzBAqcH4gukNDzjukzG7nJbmgjik8XGxgn5gUafpQHlSI40F0hx+lSgB45oQeuubxdFoEzFf0agJg==" subTotal="936.16" descuento="109.43" motivoDescuento="DEDUCCIONES NOMINA" total="826.73" tipoDeComprobante="egreso" metodoDePago="DEPOSITO" LugarExpedicion="OAXACA"><cfdi:Emisor rfc="PRO121229SL3" nombre="PROMAZAAO SA DE CV"><cfdi:DomicilioFiscal calle="DIAGONAL DE MARGARITAS 109 B COL REFORMA OAXACA DE JUAREZ OAXACA" noExterior="109" colonia="REFORMA" localidad="OAXACA" municipio="OAXACA DE JUAREZ" estado="OAXACA" pais="MEXICO" codigoPostal="68000"/><cfdi:RegimenFiscal Regimen="PERSONAS MORALES DEL REGIMEN GENERAL"/></cfdi:Emisor><cfdi:Receptor rfc="AAJA750916PP5" nombre="ALAVEZ JUAREZ ARTURO"/><cfdi:Conceptos><cfdi:Concepto cantidad="1" unidad="Servicio" descripcion="PAGO DE NOMINA" valorUnitario="936.16" importe="936.16"/></cfdi:Conceptos><cfdi:Impuestos><cfdi:Retenciones><cfdi:Retencion impuesto="ISR" importe="0.00"/></cfdi:Retenciones></cfdi:Impuestos><cfdi:Complemento><nomina:Nomina xmlns:nomina="http://www.sat.gob.mx/nomina" xsi:schemaLocation="http://www.sat.gob.mx/nomina http://www.sat.gob.mx/sitio_internet/cfd/nomina/nomina11.xsd" Version="1.1" RegistroPatronal="D6857571105" NumEmpleado="1" CURP="AAJA750916HOCLRR06" TipoRegimen="2" NumSeguridadSocial="78927504239" FechaPago="2014-01-04" FechaInicialPago="2013-12-30" FechaFinalPago="2014-01-05" NumDiasPagados="7" FechaInicioRelLaboral="1992-05-11" Antiguedad="1130" Puesto="JOYERO" PeriodicidadPago="Semanal" RiesgoPuesto="2"><nomina:Percepciones TotalGravado="599.14" TotalExento="337.02"><nomina:Percepcion TipoPercepcion="001" Clave="008" Concepto="Sueldo" ImporteGravado="599.14" ImporteExento="0"/><nomina:Percepcion TipoPercepcion="017" Clave="009" Concepto="Subsidio" ImporteGravado="0" ImporteExento="60.46"/><nomina:Percepcion TipoPercepcion="016" Clave="019" Concepto="Alimentacion" ImporteGravado="0.00" ImporteExento="276.56"/></nomina:Percepciones><nomina:Deducciones TotalGravado="0" TotalExento="109.43"><nomina:Deduccion TipoDeduccion="002" Clave="023" Concepto="ISR" ImporteGravado="0" ImporteExento="0.00"/><nomina:Deduccion TipoDeduccion="001" Clave="024" Concepto="Cuotas IMSS" ImporteGravado="0" ImporteExento="15.22"/><nomina:Deduccion TipoDeduccion="004" Clave="025" Concepto="Retencion por alimentacion" ImporteGravado="0" ImporteExento="94.21"/><nomina:Deduccion TipoDeduccion="007" Clave="030" Concepto="Pension alimenticia" ImporteGravado="0" ImporteExento="0"/></nomina:Deducciones></nomina:Nomina></cfdi:Complemento></cfdi:Comprobante>';

# In newer PHP versions the SoapLib class automatically converts FILE parameters to base64, so the next line is not needed, otherwise uncomment it
#$xml_content = base64_encode($xml_content);

# Consuming the stamp service
//$url = "http://demo-facturacion.finkok.com/servicios/soap/stamp.wsdl";
$url = "https://facturacion.finkok.com/servicios/soap/stamp.wsdl";

$client = new SoapClient($url);

$params = array(
  "xml" => $xml_content,
  "username" => $username,
  "password" => $password
);
$response = $client->__soapCall("stamp", array($params));
print_r($response);
?>
